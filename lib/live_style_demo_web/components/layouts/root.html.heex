<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
  data-style-terminal-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :terminal})}
  data-style-blueprint-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :blueprint})}
  data-style-solar-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :solar})}
  data-style-navy-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :navy})}
  data-style-forest-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :forest})}
  data-style-lavender-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :lavender})}
  data-style-brutal-class={theme({LiveStyleDemoWeb.Tokens.Semantic, :brutal})}
  data-space-compact-class={theme({LiveStyleDemoWeb.Tokens.Space, :compact})}
  data-space-cozy-class={theme({LiveStyleDemoWeb.Tokens.Space, :cozy})}
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <meta name="csrf-token" content={get_csrf_token()} />

    <script>
      ;(() => {
        const root = document.documentElement
        const splitClasses = (value) => (value || "").split(/\s+/).filter(Boolean)

        const themeClasses = {
          "terminal": root.dataset.styleTerminalClass,
          "blueprint": root.dataset.styleBlueprintClass,
          "solar": root.dataset.styleSolarClass,
          "navy": root.dataset.styleNavyClass,
          "forest": root.dataset.styleForestClass,
          "lavender": root.dataset.styleLavenderClass,
          "brutal": root.dataset.styleBrutalClass,
        }

        const spaceClasses = {
          compact: root.dataset.spaceCompactClass,
          cozy: root.dataset.spaceCozyClass,
        }

        const appearance = (() => {
          const stored = window.localStorage?.getItem("ls-appearance")
          if (stored) return stored
          return "default"
        })()

        const applyAppearance = (value) => {
          Object.values(themeClasses).forEach((cls) => {
            splitClasses(cls).forEach((c) => root.classList.remove(c))
          })

          let colorScheme = "light"

          if (value === "default") {
            colorScheme = "light"
          } else if (themeClasses[value]) {
            splitClasses(themeClasses[value]).forEach((c) => root.classList.add(c))
            // Terminal (black) and Blueprint (dark blue) are dark themes
            // Navy is dark, Solar is light
            if (value === "solar" || value === "lavender" || value === "brutal") {
                colorScheme = "light"
            } else {
                colorScheme = "dark"
            }
          }

          root.dataset.theme = colorScheme
          root.style.colorScheme = colorScheme
          root.dataset.styleTheme = value
        }

        const applySpacing = (value) => {
          Object.values(spaceClasses).forEach((cls) => {
            splitClasses(cls).forEach((c) => root.classList.remove(c))
          })

          if (spaceClasses[value]) {
            splitClasses(spaceClasses[value]).forEach((c) => root.classList.add(c))
          }
          root.dataset.spaceScale = value
        }

        applyAppearance(appearance)

        const space = window.localStorage?.getItem("ls-space") || "default"
        applySpacing(space)
      })()
    </script>
    <.live_title default="LiveStyle Demo" suffix=" Â· LiveStyle">
      {assigns[:page_title]}
    </.live_title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <link phx-track-static rel="stylesheet" href={~p"/assets/live.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/js/app.js"}>
    </script>
  </head>
  <body>
    <LiveStyleDemoWeb.ViewTransition.hook_definition />
    {@inner_content}
  </body>
</html>
